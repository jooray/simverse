  ${NAME}:
    <<: *shared
    image: ${SIMVERSE_DOCKER_IMAGE_PREFIX}${SIMNET_NAME}_lightning
    container_name: ${SIMVERSE_DOCKER_CONTAINER_PREFIX}${SIMNET_NAME}_${NAME}
    command: ["run"]
    build:
      context: .
      dockerfile: docker/lightning/Dockerfile
      args:
        - GCFLAGS=$GCFLAGS
        - SIMVERSE_HOST_UID=$SIMVERSE_HOST_UID
        - SIMVERSE_HOST_GID=$SIMVERSE_HOST_GID
        - LIGHTNING_DOCKER_BUILDTIME_IMAGE=$LIGHTNING_DOCKER_BUILDTIME_IMAGE
        - LIGHTNING_DOCKER_RUNTIME_IMAGE=$LIGHTNING_DOCKER_RUNTIME_IMAGE
        - LIGHTNING_REPO_PATH=$LIGHTNING_REPO_PATH
        - LIGHTNING_CONF_PATH=$LIGHTNING_CONF_PATH
        - RELEVANT_BITCOIND_IMAGE=${SIMVERSE_DOCKER_IMAGE_PREFIX}${SIMNET_NAME}_bitcoind
        - LIGHTNING_DEVELOPER_FLAG=$LIGHTNING_DEVELOPER_FLAG
        - LIGHTNING_VALGRIND_FLAG=$LIGHTNING_VALGRIND_FLAG
        - LIGHTNING_CONFIGURE_OPTS=$LIGHTNING_CONFIGURE_OPTS
    ports:
      - $SIMVERSE_HOST_BIND$(($SERVICE_READY_PORT_ON_HOST+$SERVICE_COUNTER)):$SERVICE_READY_PORT # readiness signal port
      - $SIMVERSE_HOST_BIND$LIGHTNING_SERVER_PORT_ON_HOST:${LIGHTNING_P2P_PORT} # lightning p2p port
      - $SIMVERSE_HOST_BIND$LIGHTNING_RPC_PORT_ON_HOST:${LIGHTNING_RPC_PORT} # lightning rpc port
    volumes:
      # !DANGER! when touching this, review cookbook.sh > prepare_lightning_volumes
      - ./_volumes/lightning-data-${NAME}:/home/simnet/.lightning # lightning data dir
    labels:
      - "simverse.role=ln"
      - "simverse.flavor=lightning"
      - "simverse.service_counter=${SERVICE_COUNTER}"
      - "simverse.role_counter=${LN_COUNTER}"
      - "simverse.flavor_counter=${LIGHTNING_COUNTER}"
    environment:
      - CONTAINER_NAME=${NAME}
      - REPORT_ENV=${SIMVERSE_REPORT_ENV}
      - SERVICE_READY_PORT=${SERVICE_READY_PORT}
      - CONTAINER_SERVICE_PORT=${CONTAINER_SERVICE_PORT}
      - SERVICE_COUNTER=${SERVICE_COUNTER}
      - EXPOSE_TCP=true # TODO: maybe we want to move this somewhere else
      - LN_COUNTER=${LN_COUNTER}
      - LIGHTNING_COUNTER=${LIGHTNING_COUNTER}
      - DEBUG=${DEBUG}
      - RPC_USER=${RPC_USER}
      - RPC_PASS=${RPC_PASS}
      - LIGHTNING_ALIAS=${NAME}
      - LIGHTNINGD_EXTRA_PARAMS=${LIGHTNINGD_EXTRA_PARAMS}
      - LIGHTNING_CLI_EXTRA_PARAMS=${LIGHTNING_CLI_EXTRA_PARAMS}
      - LIGHTNING_CHAIN=${LIGHTNING_CHAIN}
      - LIGHTNING_BACKEND=${LIGHTNING_BACKEND}
      - LIGHTNING_P2P_BIND=${LIGHTNING_P2P_BIND}
      - LIGHTNING_P2P_PORT=${LIGHTNING_P2P_PORT}
      - LIGHTNING_RPC_BIND=${LIGHTNING_RPC_BIND}
      - LIGHTNING_RPC_PORT=${LIGHTNING_RPC_PORT}
      - LIGHTNING_BITCOIN_RPC_HOST=${LIGHTNING_BITCOIN_RPC_HOST}
      - BITCOIN_RPC_PORT=${BITCOIN_RPC_PORT}
      - FAUCET_ADDR=${FAUCET_ADDR}
      - FAUCET_ADDR_PRIVATE_KEY=${FAUCET_ADDR_PRIVATE_KEY}
      - ZMQ_PUBRAWBLOCK_PORT=${ZMQ_PUBRAWBLOCK_PORT}
      - ZMQ_PUBRAWTX_PORT=${ZMQ_PUBRAWTX_PORT}
    $SIMVERSE_EXTRA_SERVICE_CONFIG
